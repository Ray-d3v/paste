# Repository Guidelines

## Product Goal
Implement a Paste (mac)-like clipboard UI using **C# / WinUI 3**.
- The UI is toggled by global hotkey `Ctrl+Alt+V`.
- It should slide up from the bottom of the screen when shown.
- The experience should feel lightweight, fast, and keyboard-first.

## Project Structure & Module Organization
Current implementation lives in `PasteWinUI/`.
- `PasteWinUI/App.xaml` and `PasteWinUI/App.xaml.cs`: app startup and lifecycle.
- `PasteWinUI/MainWindow.xaml` and `PasteWinUI/MainWindow.xaml.cs`: overlay UI and interaction behavior.
- `PasteWinUI/PasteWinUI.csproj`: project configuration (`net8.0-windows`, WinUI 3 / Windows App SDK).
- Build outputs are generated under `PasteWinUI/bin/` and `PasteWinUI/obj/` (do not edit or commit generated files).

If tests are added, place them in a top-level `Tests/` folder (example: `Tests/PasteWinUI.Tests/`).

## Build, Test, and Development Commands
Run commands from repository root:
- `dotnet restore PasteWinUI/PasteWinUI.csproj` - restore NuGet dependencies.
- `dotnet build PasteWinUI/PasteWinUI.csproj -c Release` - compile and validate the app.
- `powershell -ExecutionPolicy Bypass -File scripts/build-local-exe.ps1` - stop running instances, publish local EXE, and launch it for immediate local verification.
- `powershell -ExecutionPolicy Bypass -File scripts/install-git-hooks.ps1` - install local git hooks (`pre-push`) to block push when EXE verification fails.
- `powershell -ExecutionPolicy Bypass -File scripts/push-and-launch.ps1 <git-push-args>` - run `git push`; on success, auto-launch EXE only for `main` and `release/*`.
- `dotnet test` - run tests when test projects are present.

If the app is currently running and output files are locked, either stop the process or build to a separate output directory:
- `dotnet build PasteWinUI/PasteWinUI.csproj -c Release -p:OutDir=artifacts/verify/`
- `OutDir` must be outside `PasteWinUI/` (for example `artifacts/...` at repository root, not `PasteWinUI/artifacts/...`).
- Rationale: output under `PasteWinUI/artifacts` can be picked up recursively by MSBuild item discovery and cause later build/run failures (`MSB3030` path recursion issues).

After any code fix, always restart the app before validating behavior:
- Stop existing processes (`PasteWinUI.exe` and `dotnet` process hosting this project).
- Start again with `powershell -ExecutionPolicy Bypass -File scripts/build-local-exe.ps1`.
- Do not report UI behavior as fixed until after restart.
- For local immediate checks, validate with the published EXE generated by the script above.

Pre-push gate for local EXE verification:
- Install once per clone: `powershell -ExecutionPolicy Bypass -File scripts/install-git-hooks.ps1`
- On every `git push`, the hook runs `scripts/build-local-exe.ps1 -NoLaunch`.
- If EXE generation fails, push is blocked.
- Emergency bypass (use sparingly): `git push --no-verify`

Push-success auto-launch flow:
- Use `powershell -ExecutionPolicy Bypass -File scripts/push-and-launch.ps1 <git-push-args>`.
- It launches EXE only when the current branch is `main` or `release/*`.
- On other branches, push still runs but EXE launch is skipped.

## Coding Style & Naming Conventions
- Use 4-space indentation for C# and XAML.
- Keep nullable reference types enabled; avoid suppressing warnings without reason.
- C# naming: `PascalCase` for types/methods/properties, `camelCase` for locals/fields (private fields may use `_camelCase`).
- Keep UI logic in `MainWindow.xaml.cs`; keep startup/system integration in `App.xaml.cs`.
- Prefer small methods with clear responsibilities and minimal side effects.

## Testing Guidelines
No automated tests exist yet. For new behavior:
- Add unit tests with xUnit or NUnit in `Tests/`.
- Name test files as `<ClassName>Tests.cs` and test methods as `MethodName_Condition_ExpectedResult`.
- Cover hotkey registration paths and window geometry/visibility logic.

## Harness-Driven Workflow
Use this workflow for AI-assisted tasks to improve speed and reliability.

### 1) Start With Explicit Task Framing
- Define: goal, constraints, non-goals, and acceptance checks before editing.
- Prefer short, testable requirements over broad requests.
- If uncertainty exists, ask 1-3 clarification questions before implementation.

### 2) Work In Small, Verifiable Steps
- Make one logical change set at a time.
- After each change set, run the smallest relevant verification (`build`, targeted run, or test).
- Record failures with concrete error output, then iterate.

### 3) Require Evidence, Not Claims
- Do not mark work as complete without command-based verification where possible.
- For UI behavior, include explicit manual verification steps in summaries.
- When verification is blocked (e.g., file lock), state exactly why and provide fallback validation.

### 4) Preserve Operator Control
- Ask before destructive actions (mass delete, reset, force operations, process termination).
- Prefer reversible edits and minimal diffs.
- Keep existing unrelated changes intact.

### 5) Optimize Prompting For Execution
- Use direct instructions with exact file paths and success criteria.
- Include examples of desired behavior and edge cases.
- Prefer "do X, then verify with Y command" phrasing.

### 6) Close Each Task With a Structured Report
- Summarize:
  - what changed,
  - where it changed (file paths),
  - what was verified (commands and results),
  - what remains risky or unverified.

## Default Acceptance Checklist
For feature changes, aim to satisfy all items:
- Project builds successfully (`dotnet build ... -c Release`).
- New behavior is reachable via intended user interaction.
- Existing keyboard navigation and hotkey behavior are preserved.
- No regression in overlay show/hide and selection/paste flow.
- Any limitation or unverified path is explicitly documented.

## Commit & Pull Request Guidelines
Git history may be unavailable in this workspace. Use this convention:
- Commit messages: imperative, scoped, concise (example: `feat: add search toggle in overlay header`).
- Keep commits focused to one logical change.
- PRs should include summary, rationale, verification steps, and screenshots/GIFs for UI changes.
- Link related issue IDs when applicable.
